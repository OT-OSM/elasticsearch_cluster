---
# update environment for elasticsearch
- name: Configure elasticsearch service and environment
  template:
    src: "{{ item.name }}"
    dest: "{{ item.path }}"
  with_items:
    - {name: "limit.conf.j2", path: "/etc/security/limits.d/{{ es }}.conf"}
    - {name: "{{ es_service }}.j2", path: "/usr/lib/systemd/system/{{ es_service }}"}
  notify:
    - reload systemd
    - restart elasticsearch
  when: standalone == 'no'

# update elasticsearch config files
- name: Create elasticsearch configuration files.
  template:
    src: "{{ item.name }}"
    dest: "{{ item.path }}"
  with_items:
    - {name: "{{ es }}-{{ elasticsearch_series }}.yml.j2", path: "/etc/elasticsearch/{{ es }}.yml"}
    - {name: "jvm-{{ elasticsearch_series }}.options.j2", path: "/etc/elasticsearch/jvm.options"}
  notify:
    - restart elasticsearch
  when: standalone == 'no'

- name: Create elasticsearch configuration files for standalone.
  template:
    src: "{{ item.name }}"
    dest: "{{ item.path }}"
  with_items:
    - {name: "elasticsearch-standalone.yml.j2", path: "/etc/elasticsearch/{{ es }}.yml"}
    - {name: "jvm-{{ elasticsearch_series }}.options.j2", path: "/etc/elasticsearch/jvm.options"}
  notify:
    - restart elasticsearch
  when: standalone == 'no'

